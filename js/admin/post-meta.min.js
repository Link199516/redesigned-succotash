jQuery(document).ready(function(e){"use strict";function i(i){var t=[];e(i).children(".thumb").children("img").each(function(){t.push(e(this).data("img-id"))}),i.siblings(".at-upload-to-gallery-ids").val(t.join(","))}function t(i){var t=i.children(".at-upload-to-gallery-ids"),a=i.children(".at-upload-to-gallery-preview");e.ajax({type:"post",url:napoleon_plugin_PostMeta.ajaxurl,data:{action:"napoleon_plugin_featgal_AJAXPreview",ids:t.val()},dataType:"text",beforeSend:function(){a.empty().html("<p>"+napoleon_plugin_PostMeta.tLoading+"</p>")},success:function(i){"FAIL"==i?a.empty().html("<p>"+napoleon_plugin_PostMeta.tPreviewUnavailable+"</p>"):(i=e.parseJSON(i),a.empty(),e.each(i,function(i,t){e('<div class="thumb"><img src="'+t.url+'" data-img-id="'+t.id+'"><a href="#" class="close media-modal-icon" title="'+napoleon_plugin_PostMeta.tRemoveFromGallery+'"></a></div>').appendTo(a)}))}})}e(".at-cf-wrap .napoleon-color-picker").each(function(){e(this).wpColorPicker()}),e(".at-cf-wrap .napoleon-alpha-color-picker").alphaColorPicker(),e(".at-cf-wrap").each(function(){if(e(this).find(".at-cf-section").length>1){var i=e(this),t=i.find(".at-cf-section");t.not(":first").hide(),e('<ul class="at-cf-tabs"></ul>').prependTo(i),t.each(function(){var t=e(this).find(".at-cf-title").text(),a=e('<li class="at-cf-tab"></li>').html(t);e(".at-cf-tabs",i).append(a)});var a=e(".at-cf-tab",i);a.first().addClass("at-cf-tab-active"),a.on("click",function(i){e(this).addClass("at-cf-tab-active").siblings(".at-cf-tab").removeClass("at-cf-tab-active");var t=e(this).index(),a=e(this).parents(".at-cf-wrap").children(".at-cf-section").get(t);e(a).show().siblings(".at-cf-section").hide(),"object"==typeof google&&"object"==typeof google.maps&&e(a).find(".gllpLatlonPicker").length>0&&google.maps.event.trigger(window,"resize",{}),i.preventDefault()})}}),e("body").on("click",".at-media-button",function(i){i.preventDefault();var t=e(this),a=t.siblings(".at-uploaded-id"),l=t.siblings(".at-uploaded-url"),c=t.siblings(".upload-preview"),n=t.data("multi"),o=t.data("frame");void 0===n&&(n=!1),void 0===o&&(o="select");var s=wp.media({frame:o,title:1==n?napoleon_plugin_PostMeta.tSelectFiles:napoleon_plugin_PostMeta.tSelectFile,button:{text:1==n?napoleon_plugin_PostMeta.tUseTheseFiles:napoleon_plugin_PostMeta.tUseThisFile},multiple:n}).on("select",function(){s.state().get("selection").map(function(e){var e=e.toJSON();if(0==n&&(a.length>0&&a.val(e.id).trigger("change"),l.length>0&&l.val(e.url).trigger("change"),c.length>0)){var i='<img src="'+e.sizes.thumbnail.url+'" /><a href="#" class="close media-modal-icon" title="'+napoleon_plugin_PostMeta.tRemoveImage+'"></a>';c.html(i)}})}).open()}),e("body").on("click",".at-upload-preview a.close",function(i){i.preventDefault(),e(this).parent().html("").siblings(".at-uploaded-id").val("")}),e("body").on("click",".at-upload-to-gallery",function(i){i.preventDefault();var a=e(this),l=a.parents(".at-media-manager-gallery"),c=a.siblings(".at-upload-to-gallery-ids"),n=(a.siblings("p").find('.at-upload-to-gallery-random > input[type="checkbox"]'),wp.media({frame:"select",title:napoleon_plugin_PostMeta.tSelectFiles,button:{text:napoleon_plugin_PostMeta.tUseTheseFiles},multiple:!0}).on("select",function(e){var i=n.state().get("selection"),a=c.val(),o=[];a.length>0&&(o=a.split(",")),i.map(function(e){var e=e.toJSON();o.push(e.id)}),c.val(o.join(",")),t(l)}).open())}),e("body").on("click",".at-media-manager-gallery .thumb a.close",function(t){t.preventDefault();var a=e(this).parent().parent();e(this).parent().remove(),i(a)});var a=e(".at-upload-to-gallery-preview");a.length>0&&a.sortable({update:function(t,a){i(e(this))}})});